
## Update


<p>
    We now add the cpu multi process version of "ImgSplit" and "ResultMerge", gpu version of polygon nms.
</p>

## Functions

The code is useful for <a href="http://captain.whu.edu.cn/DOTAweb/">DOTA<a> or
<a href="http://captain.whu.edu.cn/ODAI/">ODAI<a>. The code provide the following function
<ul>
    <li>
        Load and image, and show the bounding box on it.
    </li>
    <li>
        Evaluate the result.
    </li>
    <li>
        Split and merge the picture and label.
    </li>
</ul>

### 1. What is DOTA?
<p>
Dota is a large-scale dataset for object detection in aerial images. 
It can be used to develop and evaluate object detectors in aerial images. 
We will continue to update DOTA, to grow in size and scope and to reflect evolving real-world conditions.
Different from general object detectin dataset. Each instance of DOTA is labeled by an arbitrary (8 d.o.f.) quadrilateral.
For the detail of <strong style="color:blue"> DOTA-v1.0</strong>, you can refer to our 
<a href="https://arxiv.org/abs/1711.10398">paper</a>.
</p>

### 2. What is DOAI?

[DOAI2019](https://captain-whu.github.io/DOAI2019) is a contest of Detecting Objects in Aerial Images on [CVPR'2019]("http://cvpr2019.thecvf.com/"). It is based on DOTA-v1.5.



[DOAI2018](https://captain-whu.github.io/ODAI) is a contest of object detetion in aerial images on [ICPR'2018]("http://www.icpr2018.org/"). It is based on [DOTA-v1]("http://captain.whu.edu.cn/DOTAweb/"). The contest is closed now. 


### 3. Installation
1. install swig
```
sudo apt-get install swig
```
windows swig安装方法：

[https://blog.csdn.net/HaoZiHuang/article/details/126200299](https://blog.csdn.net/HaoZiHuang/article/details/126200299)

2. create the c++ extension for python
```
swig -c++ -python polyiou.i
python setup.py build_ext --inplace
```

### 4. Usage
0. 关于使用概述, 直接使用 "demo.ipynb", 里面有图像的切分与合并等用法.
1. Reading and visualizing data, you can use DOTA.py.
2. 评估结果, 可以使用"dota_evaluation_task1.py" 与 "dota_evaluation_task2.py" (如果是DOTA-v1.5则使用 "dota-v1.5_evaluation_task1.py" and "dota-v1.5_evaluation_task2.py")
3. Split the large image, you can refer to the "ImgSplit"
4. Merging the results detected on the patches, you can refer to the ResultMerge.py
5. 如果仅仅想分割 test 集的图，而不分割对应的标注(test集没有标注)，则可以使用"SplitOnlyImage.py" 和 "SplitOnlyImage_multi_process.py", 后者比前者多了多进程池并行

An example is shown in the demo.
The subdirectory of "basepath"(which is used in "DOTA.py", "ImgSplit.py") is in the structure of
```
.
├── images
└── labelTxt
```

### 5. 关于两个任务是什么
内容摘自DOTA数据官网: [https://captain-whu.github.io/DOTA/tasks.html](https://captain-whu.github.io/DOTA/tasks.html)

#### Task1 - Detection with oriented bounding boxes (Recommended)
> The aim of this task is to locate the ground object instances with an OBB.

本任务的目标是旋转目标检测

#### Submission Format
You need to submit a zip file containing results for all test images for evaluation. The results are stored in n (n is the numer of categories) files, "**Task1_plane.txt**, **Task1_storage-tank.txt**, ...", each file contains all the detections for a specific category. Each file is in the following format:


```			
imgname score x1 y1 x2 y2 x3 y3 x4 y4
imgname score x1 y1 x2 y2 x3 y3 x4 y4
... 
```

#### Evaluation Protocol
> The evaluation protocol for oriented bounding box is a little different from the protocol in the original PASCAL VOC. We use the intersection over the union area of two polygons(ground truth and prediction) to calculate the IoU. The rest follows the PASCAL VOC.

旋转边界框(oriented bounding box, obb)的评估方式与原始 PASCAL VOC 中的评估方式略有不同. 我们使用两个多边形(GT与pred)的交并比去计算IoU. 其余与 PASCAL VOC 中的处理方式相同.

#### Task2 - Detection with horizontal bounding boxes
> Detecting object with horizontal bounding boxes is usual in many previous contests for object detection. The aim of this task is to accurately localize the instance in terms of horizontal bounding box with (xmin, ymin, xmax, ymax) format. In the task, the ground truths for training and testing are generated by calculating the horizontal bounding boxes over original annotated bounding boxes.

在之前的许多目标检测竞赛中，使用水平边界框检测目标是很常见的。此任务的目的是以`(xmin, ymin, xmax, ymax)`格式准确定位实例的水平边界框。在该任务中，通过旋转边界框的上下边界来生成水平边界框(horizontal bounding boxes, hbb)

#### Submission Format
You need to submit a zip file containing results for all test images for evaluation. The results are stored in n (n is the numer of categories) files, "**Task2_plane.txt**, **Task2_storage-tank.txt**, ...", each file contains all the results for a specific category.

```
imgname score xmin ymin xmax ymax
imgname score xmin ymin xmax ymax
... 
```

#### Evaluation Protocol
> The evaluation protocol for horizontal bounding boxes follows the PASCAL VOC benchmark, which uses mean Average Precision(**mAP**) as metric.

评估方式与 PASCAL VOC 中相同, 使用 mAP 作为指标.